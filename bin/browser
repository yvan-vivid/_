#!/usr/bin/env bash
################################################################################
# Yvan Vivid -- Browser startup script
################################################################################

declare log
mkdir -p "$DOT_LOGS_APPS"
log="$DOT_LOGS_APPS/firefox.log"

logit() { echo "$1" >> "$log"; }

[[ -z "$DISPLAY" ]] && export DISPLAY=":0"

# Build lib ref
# declare libpath
# libpath="/usr/local/apps/firefox"
# while read -r lib; do
#   libpath+=":$lib"
# done < "$DOT_STATE/firefox/firefox-loader-path"
# export LD_LIBRARY_PATH="$libpath"

declare -r \
  gtk3_schemas="/nix/store/hypvzdxqbdkc2bilp42ldbk1a9xk04h5-gtk+3-3.24.20/share/gsettings-schemas/gtk+3-3.24.20" \
  gsettings_schemas="/nix/store/7k46faqlr4gffdyksffrhllp9vav95i5-gsettings-desktop-schemas-3.34.0/share/gsettings-schemas/gsettings-desktop-schemas-3.34.0"

export XDG_DATA_DIRS="$gtk3_schemas:$XDG_DATA_DIRS"

# GTK3 Scaling
export GDK_SCALE=2

# Use Wayland
export MOZ_ENABLE_WAYLAND=1

# Use touchscreen as scroll
export MOZ_USE_XINPUT2=1

# Timestamp run
logit ""
logit "------------------------------------------------------------"
logit "$(date -Is): running 'firefox'..."
logit "------------------------------------------------------------"

# Entry
firefox >> "$log" 2>&1
ex=$?

# Exit
logit "------------------------------------------------------------"
logit "$(date -Is): ended 'firefox' with = $ex"
logit "------------------------------------------------------------"
logit ""
